<Window x:Class="Geass.Views.PreviewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Geass.ViewModels"
        Width="520"
        SizeToContent="Height"
        MaxHeight="640"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ShowInTaskbar="False"
        Topmost="True"
        ShowActivated="True"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Colors.xaml" />
                <ResourceDictionary Source="/Resources/Styles.xaml" />
                <ResourceDictionary Source="/Resources/Animations.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
        </ResourceDictionary>
    </Window.Resources>

    <!-- Outer glow + card -->
    <Border x:Name="RootBorder"
            Margin="24"
            CornerRadius="20"
            Opacity="0"
            RenderTransformOrigin="0.5,0.5">
        <Border.RenderTransform>
            <TransformGroup>
                <ScaleTransform ScaleX="0.92" ScaleY="0.92" />
                <TranslateTransform Y="16" />
            </TransformGroup>
        </Border.RenderTransform>

        <Border.Effect>
            <DropShadowEffect BlurRadius="32"
                              Opacity="0.18"
                              Direction="270"
                              ShadowDepth="8"
                              Color="#000000" />
        </Border.Effect>

        <!-- Inner card with subtle gradient background -->
        <Border CornerRadius="20"
                ClipToBounds="True">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#FFFFFF" Offset="0" />
                    <GradientStop Color="#FAFAFE" Offset="0.5" />
                    <GradientStop Color="#F5F3FA" Offset="1" />
                </LinearGradientBrush>
            </Border.Background>

            <Grid>
                <!-- Decorative accent bar at top -->
                <Border Height="3" VerticalAlignment="Top"
                        CornerRadius="20,20,0,0">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#FF6B9D" Offset="0" />
                            <GradientStop Color="#C084FC" Offset="0.5" />
                            <GradientStop Color="#818CF8" Offset="1" />
                        </LinearGradientBrush>
                    </Border.Background>
                </Border>

                <StackPanel Margin="28,20,28,24">
                    <!-- Streaming indicator -->
                    <StackPanel x:Name="StreamingIndicator"
                                Orientation="Horizontal"
                                HorizontalAlignment="Left"
                                Margin="0,0,0,12"
                                Visibility="{Binding IsStreaming, Converter={StaticResource BoolToVisibility}}">
                        <!-- Animated dots -->
                        <Ellipse x:Name="SDot1" Width="6" Height="6"
                                 Fill="{StaticResource AccentBrush}" Opacity="0.4" Margin="0,0,4,0" />
                        <Ellipse x:Name="SDot2" Width="6" Height="6"
                                 Fill="{StaticResource AccentBrush}" Opacity="0.4" Margin="0,0,4,0" />
                        <Ellipse x:Name="SDot3" Width="6" Height="6"
                                 Fill="{StaticResource AccentBrush}" Opacity="0.4" Margin="0,0,8,0" />
                        <TextBlock Text="Transcribing..."
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontFamily="Segoe UI Variable, Segoe UI, sans-serif"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Text display area - borderless, clean -->
                    <TextBox x:Name="TranscriptionTextBox"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             MaxHeight="440"
                             VerticalScrollBarVisibility="Auto"
                             Text="{Binding TranscribedText, UpdateSourceTrigger=PropertyChanged}"
                             FontSize="15"
                             FontFamily="Segoe UI Variable, Segoe UI, sans-serif"
                             Foreground="{StaticResource TextPrimaryBrush}"
                             CaretBrush="{StaticResource AccentBrush}"
                             SelectionBrush="{StaticResource AccentBrush}"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="0,0,0,4"
                             MinHeight="60" />

                    <!-- Bottom bar: hint + actions -->
                    <Grid Margin="0,16,0,0">
                        <TextBlock HorizontalAlignment="Left"
                                   VerticalAlignment="Center"
                                   FontSize="11"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontFamily="Segoe UI Variable, Segoe UI, sans-serif"
                                   Opacity="0.7">
                            <Run Text="Ctrl+Enter" FontWeight="SemiBold" />
                            <Run Text=" confirm" />
                            <Run Text="  " />
                            <Run Text="Esc" FontWeight="SemiBold" />
                            <Run Text=" cancel" />
                        </TextBlock>

                        <!-- Character count -->
                        <TextBlock x:Name="CharCount"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"
                                   FontSize="11"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontFamily="Segoe UI Variable, Segoe UI, sans-serif"
                                   Opacity="0.5" />
                    </Grid>
                </StackPanel>
            </Grid>
        </Border>
    </Border>
</Window>
