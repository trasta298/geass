<Window x:Class="Geass.Views.TranscriptionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Width="300" MinHeight="64"
        SizeToContent="Height"
        MaxHeight="640"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ShowInTaskbar="False"
        Topmost="True"
        ShowActivated="False"
        ResizeMode="NoResize"
        WindowStartupLocation="Manual">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Colors.xaml" />
                <ResourceDictionary Source="/Resources/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Border x:Name="RootBorder"
            Margin="16"
            CornerRadius="14"
            RenderTransformOrigin="0.5,1.0">
        <Border.RenderTransform>
            <TranslateTransform />
        </Border.RenderTransform>

        <Border.Background>
            <SolidColorBrush x:Name="BgBrush" Color="#E6181820" />
        </Border.Background>

        <Border.Effect>
            <DropShadowEffect BlurRadius="20"
                              Opacity="0.35"
                              Direction="270"
                              ShadowDepth="4"
                              Color="#000000" />
        </Border.Effect>

        <Border CornerRadius="14" ClipToBounds="True">
            <StackPanel>
                <!-- ═══ COMPACT STATE: Recording / Processing / Transcribing ═══ -->
                <StackPanel x:Name="CompactPanel"
                            Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            MinHeight="48"
                            Margin="20,8">

                    <!-- Recording: Waveform bars -->
                    <Canvas x:Name="WaveformCanvas" Width="48" Height="28"
                            Margin="0,0,12,0" Visibility="Collapsed">
                        <Border x:Name="Bar1" Canvas.Left="0" Canvas.Bottom="0"
                                Width="4" Height="8" CornerRadius="2"
                                Background="{StaticResource AccentBrush}" />
                        <Border x:Name="Bar2" Canvas.Left="8" Canvas.Bottom="0"
                                Width="4" Height="14" CornerRadius="2"
                                Background="{StaticResource AccentBrush}" />
                        <Border x:Name="Bar3" Canvas.Left="16" Canvas.Bottom="0"
                                Width="4" Height="20" CornerRadius="2"
                                Background="{StaticResource AccentBrush}" />
                        <Border x:Name="Bar4" Canvas.Left="24" Canvas.Bottom="0"
                                Width="4" Height="12" CornerRadius="2"
                                Background="{StaticResource AccentBrush}" />
                        <Border x:Name="Bar5" Canvas.Left="32" Canvas.Bottom="0"
                                Width="4" Height="18" CornerRadius="2"
                                Background="{StaticResource AccentBrush}" />
                        <Border x:Name="Bar6" Canvas.Left="40" Canvas.Bottom="0"
                                Width="4" Height="10" CornerRadius="2"
                                Background="{StaticResource AccentBrush}" />
                    </Canvas>

                    <!-- Recording dot -->
                    <Ellipse x:Name="RecDot" Width="8" Height="8"
                             Fill="#FF4D4D" Margin="0,0,8,0"
                             VerticalAlignment="Center"
                             Visibility="Collapsed" />

                    <!-- Processing spinner -->
                    <Path x:Name="Spinner" Width="18" Height="18"
                          Stretch="Uniform" StrokeThickness="2.5"
                          StrokeStartLineCap="Round" StrokeEndLineCap="Round"
                          Data="M 9,1 A 8,8 0 1 1 1,9"
                          Margin="0,0,10,0"
                          RenderTransformOrigin="0.5,0.5"
                          Visibility="Collapsed">
                        <Path.Stroke>
                            <SolidColorBrush Color="{StaticResource AccentColor}" />
                        </Path.Stroke>
                        <Path.RenderTransform>
                            <RotateTransform />
                        </Path.RenderTransform>
                    </Path>

                    <!-- Streaming dots -->
                    <StackPanel x:Name="StreamDotsPanel" Orientation="Horizontal"
                                Visibility="Collapsed" Margin="0,0,8,0">
                        <Ellipse x:Name="SDot1" Width="6" Height="6"
                                 Fill="{StaticResource AccentBrush}" Opacity="0.4" Margin="0,0,4,0" />
                        <Ellipse x:Name="SDot2" Width="6" Height="6"
                                 Fill="{StaticResource AccentBrush}" Opacity="0.4" Margin="0,0,4,0" />
                        <Ellipse x:Name="SDot3" Width="6" Height="6"
                                 Fill="{StaticResource AccentBrush}" Opacity="0.4" />
                    </StackPanel>

                    <!-- Status text -->
                    <TextBlock x:Name="StatusText"
                               Text="Listening..."
                               Foreground="#CCFFFFFF"
                               FontSize="13"
                               VerticalAlignment="Center"
                               FontFamily="Segoe UI Variable, Segoe UI, sans-serif"
                               FontWeight="Medium" />
                </StackPanel>

                <!-- ═══ EXPANDED STATE: Text area ═══ -->
                <StackPanel x:Name="ExpandedPanel"
                            Visibility="Collapsed"
                            Margin="20,4,20,16">

                    <TextBox x:Name="TranscriptionTextBox"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             MaxHeight="420"
                             VerticalScrollBarVisibility="Auto"
                             FontSize="15"
                             FontFamily="Segoe UI Variable, Segoe UI, sans-serif"
                             Foreground="#F0F0F2"
                             CaretBrush="{StaticResource AccentBrush}"
                             SelectionBrush="{StaticResource AccentBrush}"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="0,6,0,4"
                             MinHeight="36"
                             IsReadOnly="True" />

                    <!-- Bottom hints -->
                    <Grid Margin="0,10,0,0">
                        <TextBlock HorizontalAlignment="Left"
                                   VerticalAlignment="Center"
                                   FontSize="11"
                                   Foreground="#66FFFFFF"
                                   FontFamily="Segoe UI Variable, Segoe UI, sans-serif">
                            <Run Text="Enter" FontWeight="SemiBold" />
                            <Run Text=" 確定" />
                            <Run Text="  " />
                            <Run Text="Esc" FontWeight="SemiBold" />
                            <Run Text=" キャンセル" />
                        </TextBlock>
                        <TextBlock x:Name="CharCount"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"
                                   FontSize="11"
                                   Foreground="#44FFFFFF"
                                   FontFamily="Segoe UI Variable, Segoe UI, sans-serif" />
                    </Grid>
                </StackPanel>
            </StackPanel>
        </Border>
    </Border>
</Window>
